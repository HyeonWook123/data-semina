<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Eye Health</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Sidebar Navigation (Desktop) -->
  <nav class="sidebar-nav">
    <div style="margin-bottom: 32px; padding: 12px;">
      <h2 style="font-size: 20px; font-weight: bold; color: #1D4ED8;">Smart Eye Health</h2>
    </div>
    <a href="index.html" class="nav-item active">
      <div class="nav-icon">ğŸ </div>
      <div class="nav-label">í™ˆ</div>
    </a>
    <a href="dashboard.html" class="nav-item">
      <div class="nav-icon">ğŸ“Š</div>
      <div class="nav-label">ëŒ€ì‹œë³´ë“œ</div>
    </a>
    <a href="smartlens.html" class="nav-item">
      <div class="nav-icon">ğŸ‘“</div>
      <div class="nav-label">ìŠ¤ë§ˆíŠ¸ë Œì¦ˆ</div>
    </a>
    <a href="settings.html" class="nav-item">
      <div class="nav-icon">âš™ï¸</div>
      <div class="nav-label">ì„¤ì •</div>
    </a>
  </nav>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="location-time">
        <span class="location-icon">ğŸ“</span>
        <span id="currentTime">Seoul, 10:40 AM</span>
      </div>
    </div>

    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button class="mode-btn active" onclick="setMode('working')">ìš´ì „ ëª¨ë“œ</button>
      <button class="mode-btn" onclick="setMode('driving')">ì‘ì—… ëª¨ë“œ</button>
    </div>

    <!-- Main Gauge -->
    <div class="card" style="text-align: center;">
      <div class="gauge-container">
        <svg class="gauge-svg" viewBox="0 0 240 240" preserveAspectRatio="xMidYMid meet">
          <circle class="gauge-bg" cx="120" cy="120" r="108"></circle>
          <circle id="gaugeFill" class="gauge-fill" cx="120" cy="120" r="108"></circle>
        </svg>
        <div class="gauge-value">
          <div class="gauge-label">ëˆˆ í”¼ë¡œë„</div>
          <div class="gauge-number" id="fatigueValue">78</div>
        </div>
      </div>
      <div class="status-badge">ì£¼ì˜</div>
    </div>

    <!-- Alert Tags -->
    <div class="alert-tags">
      <div class="alert-tag warning">ğŸ˜Š ì¡¸ìŒ ê°€ëŠ¥ì„±â†‘</div>
      <div class="alert-tag danger">â˜€ï¸ ë°ê¸° ê³¼ë‹¤â†‘</div>
      <div class="alert-tag warning">ğŸ‘ï¸ ê¹œë¹¡ì„ ë¶€ì¡±â†“</div>
    </div>

    <!-- Sensor Data -->
    <div class="sensor-grid">
      <div class="card sensor-card">
        <div class="sensor-label">ì•ˆì••</div>
        <div class="sensor-value" id="pressureValue">18</div>
        <div class="sensor-unit">mmHg</div>
      </div>
      <div class="card sensor-card">
        <div class="sensor-label">ì¡°ë„</div>
        <div class="sensor-value" id="brightnessValue">800</div>
        <div class="sensor-unit">lux</div>
      </div>
      <div class="card sensor-card">
        <div class="sensor-label">ê¹œë¹¡ì„</div>
        <div class="sensor-value" id="blinkValue">12</div>
        <div class="sensor-unit">/min</div>
      </div>
    </div>

    <!-- Insights -->
    <div class="section">
      <div class="section-title">ìµœê·¼ ì„¼ì„œ ìš”ì•½</div>
      <div class="card insight-card info">
        <div class="insight-icon">ğŸŒŠ</div>
        <div class="insight-content">
          <div class="insight-title">ì•ˆì•• ë³€í™”</div>
          <div class="insight-text">
            ìµœê·¼ 4ì‹œê°„ í‰ê·  <span id="avgPressure">17.5</span>mmHgë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤. ê¸‰ê²©í•œ ë³€í™”ëŠ” ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="card insight-card info">
        <div class="insight-icon">ğŸ’</div>
        <div class="insight-content">
          <div class="insight-title">ì£¼ë³€ ë°ê¸°</div>
          <div class="insight-text">
            í˜„ì¬ ì¡°ë„ê°€ <span id="currentBrightness">800</span>luxì…ë‹ˆë‹¤. ì ì • ë²”ìœ„ ë‚´ì…ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>

    <!-- 30ë¶„ ì¶”ì´ -->
    <div class="section">
      <div class="section-title">30ë¶„ ì¶”ì´</div>
      <div class="card">
        <div class="chart-row">
          <div class="chart-label">í”¼ë¡œë„</div>
          <div class="chart-badge" style="color: #FFB800;">ë†’ìŒ</div>
        </div>
        <div class="mini-chart">
          <canvas id="fatigueChart" width="400" height="40"></canvas>
        </div>

        <div class="chart-row">
          <div class="chart-label">ì•ˆì••</div>
          <div class="chart-badge" style="color: #3B82F6;">ì•ˆì •</div>
        </div>
        <div class="mini-chart">
          <canvas id="pressureChart" width="400" height="40"></canvas>
        </div>

        <div class="chart-row">
          <div class="chart-label">ê¹œë¹¡ì„</div>
          <div class="chart-badge" style="color: #F59E0B;">ê°ì†Œ</div>
        </div>
        <div class="mini-chart">
          <canvas id="blinkChart" width="400" height="40"></canvas>
        </div>
      </div>
    </div>

    <!-- Alert Button -->
    <button class="btn btn-primary btn-full">
      ğŸ”” ê²½ë³´ ì‹œìŠ¤í…œ í™œì„±í™”
    </button>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item active">
      <div class="nav-icon">ğŸ </div>
      <div class="nav-label">í™ˆ</div>
    </a>
    <a href="dashboard.html" class="nav-item">
      <div class="nav-icon">ğŸ“Š</div>
      <div class="nav-label">ëŒ€ì‹œë³´ë“œ</div>
    </a>
    <a href="smartlens.html" class="nav-item">
      <div class="nav-icon">ğŸ‘“</div>
      <div class="nav-label">ë Œì¦ˆ</div>
    </a>
    <a href="settings.html" class="nav-item">
      <div class="nav-icon">âš™ï¸</div>
      <div class="nav-label">ì„¤ì •</div>
    </a>
  </nav>

  <script src="js/sensor.js"></script>
  <script>
    // ì›í˜• ê²Œì´ì§€ ê·¸ë¦¬ê¸°
    function drawGauge(value) {
      const radius = 108;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference * (1 - value / 100);

      document.getElementById('gaugeFill').style.strokeDasharray = circumference;
      document.getElementById('gaugeFill').style.strokeDashoffset = offset;
    }

    // ë¯¸ë‹ˆ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    function drawMiniChart(canvasId, data, color) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;

      ctx.clearRect(0, 0, width, height);

      const max = Math.max(...data);
      const min = Math.min(...data);
      const range = max - min || 1;

      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.beginPath();

      data.forEach((value, index) => {
        const x = (index / (data.length - 1)) * width;
        const y = height - ((value - min) / range) * height;

        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });

      ctx.stroke();
    }

    // ë°ì´í„° ì—…ë°ì´íŠ¸
    function updateData() {
      const data = sensorManager.getCurrent();
      if (!data) return;

      document.getElementById('fatigueValue').textContent = data.fatigueScore;
      document.getElementById('pressureValue').textContent = data.eyePressure;
      document.getElementById('brightnessValue').textContent = data.brightness;
      document.getElementById('blinkValue').textContent = data.blinkRate;
      document.getElementById('currentBrightness').textContent = data.brightness;

      drawGauge(data.fatigueScore);

      // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
      const history = sensorManager.getHistory();
      const fatigueData = history.map(d => d.fatigueScore);
      const pressureData = history.map(d => d.eyePressure * 10);
      const blinkData = history.map(d => d.blinkRate * 5);

      drawMiniChart('fatigueChart', fatigueData.slice(-30), '#FFB800');
      drawMiniChart('pressureChart', pressureData.slice(-30), '#3B82F6');
      drawMiniChart('blinkChart', blinkData.slice(-30), '#F59E0B');
    }

    // ëª¨ë“œ ë³€ê²½
    function setMode(mode) {
      sensorManager.setMode(mode);
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // ì‹œê°„ ì—…ë°ì´íŠ¸
    function updateTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;

      document.getElementById('currentTime').textContent =
        `Seoul, ${displayHours}:${minutes} ${ampm}`;
    }

    // ì´ˆê¸°í™”
    sensorManager.start();
    updateData();
    updateTime();
    setInterval(updateTime, 1000);

    // ì„¼ì„œ ì—…ë°ì´íŠ¸ ë¦¬ìŠ¤ë„ˆ
    window.addEventListener('sensorUpdate', updateData);
  </script>
</body>
</html>
