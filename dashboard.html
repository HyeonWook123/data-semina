<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëŒ€ì‹œë³´ë“œ - Smart Eye Health</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Sidebar Navigation (Desktop) -->
  <nav class="sidebar-nav">
    <div style="margin-bottom: 32px; padding: 12px;">
      <h2 style="font-size: 20px; font-weight: bold; color: #1D4ED8;">Smart Eye Health</h2>
    </div>
    <a href="index.html" class="nav-item">
      <div class="nav-icon">ğŸ </div>
      <div class="nav-label">í™ˆ</div>
    </a>
    <a href="dashboard.html" class="nav-item active">
      <div class="nav-icon">ğŸ“Š</div>
      <div class="nav-label">ëŒ€ì‹œë³´ë“œ</div>
    </a>
    <a href="smartlens.html" class="nav-item">
      <div class="nav-icon">ğŸ‘“</div>
      <div class="nav-label">ìŠ¤ë§ˆíŠ¸ë Œì¦ˆ</div>
    </a>
    <a href="settings.html" class="nav-item">
      <div class="nav-icon">âš™ï¸</div>
      <div class="nav-label">ì„¤ì •</div>
    </a>
  </nav>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <button class="back-button" onclick="history.back()">â†</button>
      <h1 class="header-title">ë°ì¼ë¦¬ ë¦¬í¬íŠ¸</h1>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="card stat-card">
        <div class="stat-label">í‰ê·  í”¼ë¡œë„</div>
        <div class="stat-value" style="color: #F59E0B;" id="avgFatigue">75%</div>
      </div>
      <div class="card stat-card">
        <div class="stat-label">ìµœëŒ€ ì•ˆì••</div>
        <div class="stat-value" id="maxPressure">18 mmHg</div>
      </div>
      <div class="card stat-card">
        <div class="stat-label">í‰ê·  ê¹œë¹¡ì„</div>
        <div class="stat-value" id="avgBlink">15 íšŒ/ë¶„</div>
      </div>
      <div class="card stat-card">
        <div class="stat-label">ê²½ë³´ íšŸìˆ˜</div>
        <div class="stat-value" style="color: #EF4444;" id="alertCount">0 íšŒ</div>
      </div>
    </div>

    <!-- ì£¼ê°„ íŠ¸ë Œë“œ -->
    <div class="section">
      <div class="section-title">ì£¼ê°„ íŠ¸ë Œë“œ</div>
      <div style="display: flex; gap: 8px; margin-bottom: 16px;">
        <button class="btn btn-primary" style="padding: 8px 16px; border-radius: 20px; font-size: 13px;">í”¼ë¡œë„</button>
        <button class="btn btn-secondary" style="padding: 8px 16px; border-radius: 20px; font-size: 13px;">ê²½ë³´ íšŸìˆ˜</button>
        <button class="btn btn-secondary" style="padding: 8px 16px; border-radius: 20px; font-size: 13px;">ê¹œë¹¡ì„ ë¹ˆë„</button>
      </div>

      <div class="card" style="padding: 20px; background: #1F2937; height: 300px;">
        <canvas id="weeklyChart" width="400" height="280" style="width: 100%;"></canvas>
      </div>
    </div>

    <!-- ëˆ„ì  ìœ„í—˜ ì•Œë¦¼ -->
    <div class="section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <div class="section-title" style="margin-bottom: 0;">ëˆ„ì  ìœ„í—˜ ì•Œë¦¼</div>
        <button class="btn btn-secondary" style="padding: 4px 12px; font-size: 13px;">ìµœì‹ ìˆœ â–¼</button>
      </div>

      <div class="card" style="display: flex; gap: 12px; padding: 16px; background: #FEE2E2; margin-bottom: 12px;">
        <div style="font-size: 24px;">ğŸš¨</div>
        <div style="flex: 1;">
          <div style="font-weight: 600; margin-bottom: 4px;">ì¥ì‹œê°„ ê·¼ê±°ë¦¬ ì‘ì—… ê°ì§€</div>
          <div style="font-size: 13px; color: #6B7280;">ì˜¤í›„ 3:15</div>
        </div>
        <div style="padding: 4px 12px; background: #DC2626; color: white; border-radius: 12px; font-size: 12px; font-weight: 600; height: fit-content;">ë†’ìŒ</div>
      </div>

      <div class="card" style="display: flex; gap: 12px; padding: 16px; background: #FEF3C7; margin-bottom: 12px;">
        <div style="font-size: 24px;">âš¡</div>
        <div style="flex: 1;">
          <div style="font-weight: 600; margin-bottom: 4px;">ëˆˆ ê¹œë¹¡ì„ ë¹ˆë„ ì €í•˜</div>
          <div style="font-size: 13px; color: #6B7280;">ì˜¤í›„ 2:40</div>
        </div>
        <div style="padding: 4px 12px; background: #F59E0B; color: white; border-radius: 12px; font-size: 12px; font-weight: 600; height: fit-content;">ë³´í†µ</div>
      </div>

      <div class="card" style="display: flex; gap: 12px; padding: 16px; background: #FEF3C7;">
        <div style="font-size: 24px;">â˜€ï¸</div>
        <div style="flex: 1;">
          <div style="font-weight: 600; margin-bottom: 4px;">ê³¼ë„í•œ ë¸”ë£¨ë¼ì´íŠ¸ ë…¸ì¶œ</div>
          <div style="font-size: 13px; color: #6B7280;">ì˜¤ì „ 11:50</div>
        </div>
        <div style="padding: 4px 12px; background: #F59E0B; color: white; border-radius: 12px; font-size: 12px; font-weight: 600; height: fit-content;">ë³´í†µ</div>
      </div>
    </div>

    <!-- ì˜¤ëŠ˜ì˜ ì¸ì‚¬ì´íŠ¸ -->
    <div class="section">
      <div class="section-title">ì˜¤ëŠ˜ì˜ ì¸ì‚¬ì´íŠ¸</div>

      <div class="card" style="display: flex; gap: 12px; padding: 16px; background: #FEE2E2; margin-bottom: 12px;">
        <div style="font-size: 24px;">âŒ</div>
        <div>
          <div style="font-weight: 600; margin-bottom: 4px;">ê°€ì¥ ìœ„í—˜í–ˆë˜ ì‹œê°„ëŒ€</div>
          <div style="font-size: 13px; color: #4B5563; line-height: 1.4;">
            ì˜¤í›„ 2-4ì‹œ ì‚¬ì´ì— ëˆˆì˜ í”¼ë¡œë„ê°€ ê°€ì¥ ë†’ê²Œ ì¸¡ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="card" style="display: flex; gap: 12px; padding: 16px; background: #D1FAE5;">
        <div style="font-size: 24px;">ğŸ‘</div>
        <div>
          <div style="font-weight: 600; margin-bottom: 4px;">íœ´ì‹ì´ íš¨ê³¼ ìˆì—ˆë˜ êµ¬ê°„</div>
          <div style="font-size: 13px; color: #4B5563; line-height: 1.4;">
            ì˜¤ì „ 11ì‹œì˜ 20ë¶„ íœ´ì‹ì´ í”¼ë¡œë„ ê°ì†Œì— ê°€ì¥ íš¨ê³¼ì ì´ì—ˆìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <div class="nav-icon">ğŸ </div>
      <div class="nav-label">í™ˆ</div>
    </a>
    <a href="dashboard.html" class="nav-item active">
      <div class="nav-icon">ğŸ“Š</div>
      <div class="nav-label">ëŒ€ì‹œë³´ë“œ</div>
    </a>
    <a href="smartlens.html" class="nav-item">
      <div class="nav-icon">ğŸ‘“</div>
      <div class="nav-label">ë Œì¦ˆ</div>
    </a>
    <a href="settings.html" class="nav-item">
      <div class="nav-icon">âš™ï¸</div>
      <div class="nav-label">ì„¤ì •</div>
    </a>
  </nav>

  <script src="js/sensor.js"></script>
  <script>
    // ì£¼ê°„ íŠ¸ë Œë“œ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    function drawWeeklyChart() {
      const canvas = document.getElementById('weeklyChart');
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;

      // ë°°ê²½ ê·¸ë¦¬ë“œ
      ctx.strokeStyle = '#374151';
      ctx.lineWidth = 1;

      for (let i = 0; i <= 5; i++) {
        const y = (i / 5) * height;
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(width, y);
        ctx.stroke();
      }

      // ë°ì´í„° (14ì¼)
      const data = [];
      for (let i = 0; i < 14; i++) {
        data.push(230 + i * 10 + Math.random() * 20);
      }

      // ë¼ì¸ ê·¸ë¦¬ê¸°
      const max = Math.max(...data);
      const min = Math.min(...data);
      const range = max - min;

      ctx.strokeStyle = '#F59E0B';
      ctx.fillStyle = '#F59E0B';
      ctx.lineWidth = 3;
      ctx.beginPath();

      data.forEach((value, index) => {
        const x = (index / (data.length - 1)) * width;
        const y = height - ((value - min) / range) * (height - 20);

        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }

        // ì  ê·¸ë¦¬ê¸°
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.closePath();

        ctx.beginPath();
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });

      ctx.stroke();
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats() {
      const data = sensorManager.getCurrent();
      if (!data) return;

      document.getElementById('avgFatigue').textContent = data.fatigueScore + '%';
      document.getElementById('maxPressure').textContent = data.eyePressure + ' mmHg';
      document.getElementById('avgBlink').textContent = data.blinkRate + ' íšŒ/ë¶„';
    }

    // ì´ˆê¸°í™”
    sensorManager.start();
    drawWeeklyChart();
    updateStats();

    window.addEventListener('sensorUpdate', updateStats);
  </script>
</body>
</html>
